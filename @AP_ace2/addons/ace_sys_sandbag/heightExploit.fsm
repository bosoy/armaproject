class FSM
{
  fsmName = "heightExploit";
  class States
  {
    class heightExploit
    {
      name = "heightExploit";
      init = "// ace_sys_sandbag (.pbo) | (c) 2009 by rocko" \n
       "//" \n
       "// Height Exploit" \n
       "_debug = true;" \n
       "if (_debug) then {" \n
       "	_msg = format[""START %1"", time];" \n
       "	diag_log _msg;" \n
       "};";
      precondition = "";
      class Links
      {
        class _
        {
          priority = 0.000000;
          to="init";
          precondition = "";
          condition="";
          action="";
        };
      };
    };
    class init
    {
      name = "init";
      init = "ace_sys_sandbag_height_exploit = false;" \n
       "private [" \n
       """_t""," \n
       """_detectors""," \n
       """_deleted""," \n
       """_z""," \n
       """_zcoords""," \n
       """_do""," \n
       """_i""," \n
       """_amount""," \n
       """_minHeight""," \n
       """_SB""" \n
       "];" \n
       "" \n
       "player setVariable [""ace_sys_sandbag_exploit"", false];" \n
       "_do = false;" \n
       "" \n
       "_SB = _this select 0;" \n
	   "player setVariable [""ace_sys_sandbag_place_pos"",(getPos _SB),false];" \n
       "_detectors = [];" \n
       "_zcoords = [];" \n
       "" \n
       "_SB_H = 0.144;" \n
       "_minHeight = _SB_H;" \n
       "" \n
       "_SB_pos = _SB modelToWorld [0, 0, 0];" \n
       "_SB_Z = _SB_pos select 2;" \n
       "_SB_dir = getDir _SB;" \n
       "" \n
       "_amount = 10;" \n
       "" \n
       "deleteVehicle _SB;";
      precondition = "";
      class Links
      {
        class _
        {
          priority = 0.000000;
          to="create_detectors";
          precondition = "";
          condition="true";
          action="";
        };
      };
    };
    class create_detectors
    {
      name = "create_detectors";
      init = "for [{ _i = 0 },{ _i<= _amount },{ _i = _i+1 }] do {" \n
       "	_t = ""ACE_Sandbag_NoGeo_Det"" createvehicleLocal [0, 0, 200 + _i];" \n
       "	_t setDir _SB_dir;" \n
       "	_t setpos _SB_pos;" \n
       "	_detectors set [_i,_t];" \n
       "};" \n
       "" \n
       "";
      precondition = "";
      class Links
      {
        class _
        {
          priority = 0.000000;
          to="while";
          precondition = "";
          condition="";
          action="";
        };
      };
    };
    class while
    {
      name = "while";
      init = "_deleted = 0;" \n
       "for [{ _i = 0 },{ _i<= _amount },{ _i = _i+1 }] do {" \n
       "	_t = _detectors select _i;" \n
       "	if (alive _t) then" \n
       "	{" \n
       "		_z = (_t modelToWorld [0, 0, 0]) select 2;" \n
       "		_zcoords set [_i,_z];" \n
       "		if (_z < 0) then { deletevehicle _t };" \n
       "	} else { _deleted = _deleted + 1; };" \n
       "};";
      precondition = "";
      class Links
      {
        class exit
        {
          priority = 1.000000;
          to="foreach";
          precondition = "";
          condition="(_deleted == (_amount + 1))";
          action="";
        };
        class do
        {
          priority = 0.000000;
          to="while";
          precondition = "";
          condition="true";
          action="";
        };
      };
    };
    class foreach
    {
      name = "foreach";
      init = "{ " \n
       "	if ((_SB_Z - _x) <= _minheight) then { _do = true }; " \n
       "} foreach _zcoords;";
      precondition = "";
      class Links
      {
        class __do
        {
          priority = 1.000000;
          to="exploited";
          precondition = "";
          condition="!_do";
          action="";
        };
        class do
        {
          priority = 0.000000;
          to="end";
          precondition = "";
          condition="true";
          action="";
        };
      };
    };
    class exploited
    {
      name = "exploited";
      init = "player setVariable [""ace_sys_sandbag_exploit"", true];" \n
       "ace_sys_sandbag_height_exploit = true;" \n
       "" \n
       "if (_debug) then {" \n
       "	_msg = format[""END %1"", time];" \n
       "	diag_log _msg;" \n
       "};";
      precondition = "";
      class Links
      {
      };
    };
    class end
    {
      name = "end";
      init = "player setVariable [""ace_sys_sandbag_exploit"", false];" \n
       "ace_sys_sandbag_height_exploit = true;" \n
       "" \n
       "if (_debug) then {" \n
       "	_msg = format[""END %1"", time];" \n
       "	diag_log _msg;" \n
       "};";
      precondition = "";
      class Links
      {
      };
    };
  };
  initState="heightExploit";
  finalStates[] =
  {
    "exploited",
    "end",
  };
};
